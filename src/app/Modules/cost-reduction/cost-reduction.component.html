<div *ngIf="showCat3Management">
  <div class="container-fluid maxheight">
    <ngx-spinner name="spinner" bdColor="rgba(51, 51, 51, 0.8)" size="large" color="#fff" type="square-jelly-box"
      [fullScreen]="true">
      <img alt="Loading Please Wait..." style="width: 100px; height: 100px" src="../../../assets/Spin-2.gif" />
    </ngx-spinner>

    <div class="row searchbox">
      <!-- Filters Start -->
      <div class="col-md-3 border-bottom position-fixed scroll1" id="Id_Filters">
        <form [formGroup]="SearchboxForm" id="Id_Filtersform">
          <br />
          <div class="row font-size">
            <div class="col-md-12">
              <label class="form-label">Category 3 </label>
              <label class="form-label clearall" (click)="clearall()">Clear All </label><br />

              <div class="row border-bottom"></div>
              <div class="scrollbarsearch">
                <ngx-treeview #cat3 [config]="config" [items]="Cat3"
                  (selectedChange)="getCategoryId($event)"></ngx-treeview>
              </div>
            </div>
          </div>
          <br />
        </form>
      </div>

      <div class="col-md-9" id="SearchFiltersdiv">

        <div class="row border-bottom CategoryWelcome">
          <div class="col-md-8">
            <div class="form-label" style="font-weight: bold; ">
              <div style="text-align: center;font-size: 24px;font-family: Helvetica, Arial !important;">
                Welcome to the Cost Insights!
              </div>

            </div>
          </div>

          <div class="col-md-4 text-end">
            <button class="costbtn" (click)="selectAll()" style="margin-right: 5px;">
              {{ selectAllText }}
            </button>
            <button class="costbtn" (click)="toggleView()">Cost Insight</button>
          </div>
        </div>


        <div class="row setOpacity" id="SearchFilters">
          <div class="instructionLabel">
            Please select single/multiple categories below and click Cost Insight button on top right to navigate to
            arbitrage dashboards.
          </div>
          <span style="height: 30px; width: 50%;"></span>
          <div *ngFor="let c of SearchProductList | groupBy : 'parentCategory'">

            <h4 class="col-md-12 Categoryheader">
              <label id="cetegoryname">{{ c.key }}</label>
            </h4>
            <!-- <div *ngFor="let item of c.value" id="prodDetailsId" class="prodDetails" (click)="toggleSelection(item)">
              <div class="image-container">
                <input class="input1" type="checkbox" [value]="item.value" [(ngModel)]="item.selected"
                  (click)="handleCheckboxClick($event, item)" />
                <img *ngIf="item.imagePath == ''; else multi" src="assets/No-Image.png" class="prdIcon" />
                <ng-template #multi>
                  <img src="{{ item.imagePath }}" class="prdIcon" />
                </ng-template>
              </div>
              <div class="prdDescription">
                <label id="PartName">{{ item.childCategory }}</label><br />
              </div>
            </div> -->
            <div *ngFor="let item of c.value" id="prodDetailsId" class="prodDetails">
              <div class="image-container">
                <label class="clickable-wrapper">
                  <input
                    class="input1"
                    type="checkbox"
                    [value]="item.value"
                    [(ngModel)]="item.selected"
                    (click)="handleCheckboxClick($event, item)"
                  />
                  <img
                    [src]="item.imagePath || 'assets/No-Image.png'"
                    class="prdIcon"
                  />
                </label>
              </div>
              <div class="prdDescription">
                <label id="PartName">{{ item.childCategory }}</label><br />
              </div>
            </div>            
            <br /><br />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showcostinsights" style="text-align: center; padding: 20px;">
  <div class="row">
    <div class="col-12">
      <h1>Welcome to Category Management <button class="btnback" (click)="backToCat3()"
          style="float: right; margin-right: 20px;">Back</button></h1>
    </div>

    <div class="col-12">
      <marquee behavior="scroll" direction="left" scrollamount="5"
        style="font-size: 16px; background: #f3f3f3; padding: 10px; border-radius: 5px;width: 90%;">
        CAT4 - {{ getSelectedPartsString() }}
      </marquee>
    </div>

    <div class="col-12" *ngIf="activeButton === 'default' || activeButton === 'commercial'">
      <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
          <p>Your current User SC Attainment is <strong>{{ totaluserAttainment }}</strong></p>
        </div>
      </div>
    </div>

    <div class="col-12" *ngIf="activeButton !== 'design' && activeButton !== 'manufacturing'">
      <p>Your current SC Attainment is <strong>{{ totalAttainment }}</strong></p>
    </div>


    <div class="col-12" *ngIf="activeButton !== 'design' && activeButton !== 'manufacturing'">
      <p>You have current opportunities worth <strong>{{ totalVariation }}</strong></p>
    </div>

  </div>


  <div style="margin-top: 10px;">

    <button class="custom-button" [class.active]="activeButton === 'commercial'"
      (click)="setActiveButton('commercial')">
      Commercial<br>Arbitrage
    </button>

    <button class="custom-button" [class.active]="activeButton === 'regional'" (click)="setActiveButton('regional')">
      Regional<br>Arbitrage
    </button>

    <button class="custom-button" [class.active]="activeButton === 'manufacturing'"
      (click)="setActiveButton('manufacturing')">
      Mfg Process<br>Arbitrage
    </button>

    <button class="custom-button" [class.active]="activeButton === 'design'" (click)="setActiveButton('design')">
      Design<br>Arbitrage
    </button>
  </div>

</div>

<!------------------------------------------------start of Commerical Arbitrage --------------------------->

<div *ngIf="showContent" class="container-fluid"
  style="margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center;">
  <div class="row" style="width: 100%; display: flex; justify-content: center;">
    <header style="text-align: center;font-size: 24px;">
      Part Number vs Commercial Arbitrage($)
    </header>
    <div class="graph">
      <div class="chart-box">
        <canvasjs-chart class="canvas-chart" [options]="chartOptions" [styles]="getGraphstyle()"
          id="chartOptionsId"></canvasjs-chart>
      </div>
    </div>


    <div class="filterlabel" style="display: flex; flex-wrap: wrap; gap: 15px;">

      <div style="display: flex; flex-direction: column;">
        <label for="date-range">Select:</label>
        <select id="date-range" [(ngModel)]="selectedRange" (change)="onDateRangeChange()" class="custom-input"
          style="padding: 5px;">
          <option *ngFor="let range of dateRanges" [value]="range.value">{{ range.label }}</option>
        </select>
      </div>

      <div style="display: flex; flex-direction: column;">
        <label for="from-date">From Date:</label>
        <input type="date" id="from-date" [(ngModel)]="fromDate" [disabled]="selectedRange !== 'CUSTOM'"
          [attr.min]="minDate" [attr.max]="maxDate" class="custom-input" style="padding: 5px;" />
      </div>

      <div style="display: flex; flex-direction: column;">
        <label for="to-date">To Date:</label>
        <input type="date" id="to-date" [(ngModel)]="toDate" [disabled]="selectedRange !== 'CUSTOM'"
          [attr.min]="minDate" [attr.max]="maxDate" class="custom-input" style="padding: 5px;" />
      </div>

      <div style="display: flex; flex-direction: column;">
        <label for="status-filter">Status:</label>
        <select id="status-filter" [(ngModel)]="selectedStatus_commerical" class="custom-input" style="padding: 5px;">
          <option value="">All</option>
          <option value="Open">Open</option>
          <option value="Close">Close</option>
          <option value="WIP">WIP</option>
        </select>
      </div>

      <div style="display: flex; align-items: flex-end; gap: 10px; margin-top: 20px;">
        <button class="btn view-btn" (click)="onViewClick()">View</button>
        <button class="btn view-btn" (click)="ClearAll()">Clear</button>
        <img src="../../../../assets/exportexcel.png" class="exportToExcel" (click)="exportToExcel()"
          ngbTooltip="Export to Excel">
      </div>

    </div>


    <div class="col-md-6" style="max-width: 100%;width: 90%; overflow-x: auto;margin-bottom: 60px;">
      <div class="table-responsive " style="border: 1px solid #808080 ">
        <table class="table table-hover table-striped " style="width: 100%; table-layout: 100%; overflow: auto;">
          <thead>
            <tr>
              <th style="position: sticky; left: 0px; top:-1px; z-index: 4;">Sr<br>no</th>
              <th style="position: sticky; left: 32px; top: -1px;  z-index: 4;">Part Number</th>
              <!-- <th (click)="sortBy('PartNumber')">Part Number ‚¨ç</th> -->
              <th>Part Name</th>
              <th>MMID</th>
              <th>Program Name</th>
              <th> CAT4</th>
              <th>Supplier Name</th>
              <th>Supp Mfg <br>Location</th>
              <!-- <th>Annual<br> Volume</th> -->
              <th>Annual<br>Volume <span class="my-icon" (click)="sortBy('AnnualVolume',$event)"><i
                    class=" bi bi-sort-up"></i></span></th>
              <th>Updated Annual<br> Volume </th>
              <th>Should Cost <span class="my-icon" (click)="sortBy('ShouldCost',$event)"><i
                    class="bi bi-sort-up"></i></span></th>
              <th>User Simulated<br> Cost </th>
              <th>Supplier Quoted/<br>Invoice Price</th>
              <th>Delta Should Cost<br>- Invoice price</th>
              <th>SC<br>Attainment <span class="my-icon" (click)="sortBy('SCAttainment',$event)"><i
                    class="bi bi-sort-up"></i></span></th>
              <th>User SC<br> Attainment </th>
              <th>Commerical<br> Arbitrage <span class="my-icon" (click)="sortBy('CommercialArbitrage',$event)"><i
                    class="bi bi-sort-up"></i></span></th>
              <th>User Simulated <br>Arbitrage </th>
              <th>Submitted By</th>
              <th>Project Status</th>
              <th>Debrief Date</th>
              <th>Comments</th>
              <th>User <br>Activity</th>
              <th style="position: sticky; right: 0px; z-index: 3;">Action</th>
            </tr>
          </thead>
          <tbody>
            <!-- <tr *ngFor="let opportunity of opportunities;  let i=index"> -->
            <tr
              *ngFor="let opportunity of opportunities | search: textsearch:filterMetadata  | paginate: { itemsPerPage: 25, currentPage: page };  let i=index">


              <!-- <td style="position: sticky; left: 0px; ">{{i + 1}}</td> -->
              <td style="position: sticky; left:0px;">{{ (page - 1) * pageSize + i + 1 }}</td>
              <td style="position: sticky; left: 32px;">
                <span ngbTooltip="{{opportunity.PartNumber}}">{{opportunity.PartNumber.length > 10 ?
                  opportunity.PartNumber.slice(0, 10) + '...' : opportunity.PartNumber}}</span>
              </td>
              <td>
                <span ngbTooltip="{{opportunity.PartName}}"> {{opportunity.PartName.length > 12 ?
                  opportunity.PartName.slice(0, 12) + '...' : opportunity.PartName}} </span>
              </td>
              <!-- <td class="align-center">{{opportunity.MMID}}</td> -->
              <td class="align-center"> <a (click)="navigateToDetails(opportunity.CSHeaderID)"
                  class="text-underlinecolour">{{opportunity.MMID}} </a> </td>

              <td>{{opportunity.ProgramName}}</td>
              <td>{{opportunity.CAT4}}</td>
              <td>
                <span class="hover-text" ngbTooltip="{{opportunity.SupplierName}}">
                  {{ opportunity.SupplierName ? (opportunity.SupplierName.length > 12 ?
                  opportunity.SupplierName.slice(0, 12) + '...' : opportunity.SupplierName) : '' }} </span>
              </td>
              <td>{{opportunity.SupplierMfgRegion}}</td>
              <td class="align-center">{{opportunity.AnnualVolume | number:'1.0-0'}}</td>
              <!------------------------------Editble coloumn -------------------------------------->
              <td class="align-center">
                <ng-container *ngIf="editingIndex === i; else displayUpdatedAnnualVolume">
                  <input type="text-box" [(ngModel)]="opportunity.UpdatedAnnualVolume" />
                </ng-container>
                <ng-template #displayUpdatedAnnualVolume>
                  <input type="text-box"
                    [ngModel]="opportunity.UpdatedAnnualVolume ? (opportunity.UpdatedAnnualVolume | number:'1.0-0') : ''"
                    disabled />
                </ng-template>
              </td>
              <td class="align-center">{{opportunity.ShouldCost? ('$ '+ opportunity.ShouldCost.toFixed(2)) : ''}}</td>
              <!------------------------------Editble coloumn -------------------------------------->
              <td>
                <ng-container *ngIf="editingIndex === i; else displayUserCalculatedCost">
                  <input type="text-box" [(ngModel)]="opportunity.UserCalculatedCost" step="0.01"
                    (input)="validateDecimal($event)" />
                </ng-container>
                <ng-template #displayUserCalculatedCost>
                  <input type="text-box"
                    [ngModel]="opportunity.UserCalculatedCost ? '$ ' + (opportunity.UserCalculatedCost | number:'1.2-2') : ''"
                    disabled />
                </ng-template>
              </td>
              <td class="align-center"> {{opportunity.SupplierQuoted ? ('$ '+ (opportunity.SupplierQuoted |
                number:'1.2-2')): ''}}</td>
              <td class="align-center"> {{ opportunity.InvoicePriceShouldCost ? ('$ ' +
                opportunity.InvoicePriceShouldCost.toFixed(2)): '' }}</td>
              <!-- <td>{{opportunity.SCAttainment? (opportunity.SCAttainment+'%'):''}}</td> -->
              <td>{{ RoundSCAttainment(opportunity) }}</td>

              <td class="align-center">{{ calculatePercentage(opportunity) }}</td>
              <td class="align-center">{{formatToMillions(opportunity.CommercialArbitrage)}}</td>
              <td class="align-center">{{ formatToMillions(calculateOpportunityValue(opportunity)) }}</td>
              <td>{{opportunity.ModifiedBy}}</td>
              <td>
                <select [(ngModel)]="opportunity.ProjectStatus" class="form-select"
                  style="width: 100%; height: 25px; font-size: 9px; font-weight: bold;" [disabled]="editingIndex !== i">
                  <option class="ttt" value="Open" selected>Open</option>
                  <option value="WIP">WIP</option>
                  <option value="Close">Close</option>
                  <option value="Reject">Reject</option>
                </select>
              </td>
              <td>{{opportunity.DebriefDate}}</td>
              <td>
                <span (click)="openCommentsPopup(opportunity.Comments, i)" [ngbTooltip]=" opportunity.Comments "
                  [style.pointer-events]="editingIndex !== i ? 'none' : 'auto'"
                  style="cursor: pointer; color: #ef7659;">
                  {{ opportunity.Comments && opportunity.Comments.length > 12 ? (opportunity.Comments | slice:0:12) +
                  '...' : opportunity.Comments || 'Add Comment' }}
                </span>
              </td>
              <!-------------------------------------upload and download of doc --------------------------->
              <td style="text-align: center;">
                <i class="bi bi-cloud-upload-fill"
                  (click)="openUploadPopup(opportunity.CommericalArtibageID,opportunity.MMID,opportunity.RequestHeaderId)"
                  style="color: #185ca4; font-size: 17px; cursor: pointer;" ngbTooltip="Upload Document"></i>
                <i class="bi bi-download"
                  (click)="downloadArbitrageZip(opportunity.CommericalArtibageID,opportunity.PartNumber,'commercial')"
                  style="color: #2fa365; font-size: 17px; cursor: pointer; margin-left: 10px;"
                  ngbTooltip="Download Document">
                </i>

                <i class="bi bi-box-arrow-in-up-right"
                  (click)="uploadTCO(opportunity.CommericalArtibageID,opportunity.MMID,opportunity.RequestHeaderId)"
                  style="color: #f0ad4e; font-size: 17px; cursor: pointer; margin-left: 10px;"
                  ngbTooltip="Go to TCO Upload"></i>
              </td>

              <td style="position: sticky; right: 0px; text-align: center;">
                <ng-container *ngIf="editingIndex === i; else editIcon">
                  <i class="bi bi-check-circle-fill" (click)="saveChanges(opportunity)"
                    style="color: #2fa365;  font-size: 17px ; cursor: pointer;" ngbTooltip="Save"></i>
                  <i class="bi bi-x-circle-fill" (click)="cancelEditing()"
                    style="color: #da291c; font-size: 17px; cursor: pointer; margin-left: 10px;"
                    ngbTooltip="Cancel"></i>
                </ng-container>
                <ng-template #editIcon>
                  <i class="bi bi-pencil-fill" style="color: #da291c; font-size:larger; cursor: pointer; "
                    (click)="editRow(i)" ngbTooltip="Edit" placement="top"></i>
                </ng-template>
              </td>
            </tr>
          </tbody>
        </table>
        <!-------------------------------Modals------------------------------------------>
        <div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': showModal}" style="display: block;"
          *ngIf="showModal">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Edit Comment</h5>
                <label class="close modal-close-icn" (click)="closeCommentsPopup()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#000" class="bi bi-x"
                    viewBox="0 0 16 16">
                    <path
                      d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                  </svg>
                </label>
              </div>
              <div class="modal-body">
                <textarea [(ngModel)]="selectedComment" rows="4" style="width: 100%;"></textarea>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-secondary" (click)="saveComment()">Save</button>
                <button type="button" class="btn btn-sm  btn-default default-btn_popup"
                  (click)="closeCommentsPopup()">Close</button>
              </div>
            </div>
          </div>
        </div>

        <div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': showTcoUploadModal}" style="display: block;"
          *ngIf="showTcoUploadModal">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Upload Documents</h5>
                <label class="close modal-close-icn" (click)="closeUploadPopup()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#000" class="bi bi-x"
                    viewBox="0 0 16 16">
                    <path
                      d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                  </svg>
                </label>
              </div>
              <div class="modal-body">
                <div class="input-group custom-file-button" *ngIf="showFileUpload"
                  style="margin-top: 10px; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto; display: flex; gap: 10px; align-items: center;">
                  <label for="fileInput" class="input-group-text" style="flex-shrink: 0;">Select File</label>
                  <input type="file" class="form-control" style="flex: 1;" (change)="handleFileSelection($event)"
                    multiple />
                  <button type="button" class="btn btn-sm default-btn"
                    (click)="handleUpload('commercial',selectedCommercialID)"> Upload </button>
                </div>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-sm  btn-default default-btn_popup"
                  (click)="closeUploadPopup()">Close</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-between p-2 pagination">

        <ngb-pagination [collectionSize]="filterMetadata.count" [(page)]="page" [pageSize]="pageSize" [rotate]="true"
          [boundaryLinks]="true" [maxSize]="5" size="sm">
          <ng-template ngbPaginationPrevious>Prev</ng-template>
          <ng-template ngbPaginationNext>Next</ng-template>
        </ngb-pagination>
        <br>
      </div>
    </div>
  </div>
</div>
<!------------------------------------------------End of Commerical Arbitrage --------------------------->

<!------------------------------------------------start of Regional Arbitrage --------------------------->

<div *ngIf="showRegionalContent" class="container-fluid"
  style="margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center;">
  <header style="text-align: center;font-size: 24px;">
    Part Number vs Regional Arbitrage($)
  </header>
  <div class="col-12" style="margin-bottom: 20px; display: flex; justify-content: center;">

    <div class="graph">
      <div class="chart-box">
        <canvasjs-chart class="canvas-chart" [options]="RegionchartOptions" [styles]="getChartStyles()"
          id="chartOptionsId"></canvasjs-chart>
      </div>
    </div>

  </div>

  <div class="filterlabel" style="display: flex; flex-wrap: wrap; gap: 15px;">

    <!-- Select Range -->
    <div style="display: flex; flex-direction: column;">
      <label for="date-range">Select:</label>
      <select id="date-range" [(ngModel)]="selectedRange_regional" (change)="onDateRangeChange_regional()"
        class="custom-input" style="padding: 5px;">
        <option *ngFor="let range of dateRanges" [value]="range.value"> {{ range.label }} </option>
      </select>
    </div>

    <!-- From Date -->
    <div style="display: flex; flex-direction: column;">
      <label for="from-date">From Date:</label>
      <input type="date" id="from-date" [(ngModel)]="RegionalfromDate" [disabled]="selectedRange_regional !== 'CUSTOM'"
        [attr.min]="minDate" [attr.max]="maxDate" class="custom-input" style="padding: 5px;" />
    </div>

    <!-- To Date -->
    <div style="display: flex; flex-direction: column;">
      <label for="to-date">To Date:</label>
      <input type="date" id="to-date" [(ngModel)]="RegionaltoDate" [disabled]="selectedRange_regional !== 'CUSTOM'"
        [attr.min]="minDate" [attr.max]="maxDate" class="custom-input" style="padding: 5px;" />
    </div>

    <!-- Status Filter -->
    <div style="display: flex; flex-direction: column;">
      <label for="status-filter">Status:</label>
      <select id="status-filter" [(ngModel)]="selectedStatus_regional" class="custom-input" style="padding: 5px;">
        <option value="">All</option>
        <option value="Open">Open</option>
        <option value="Close">Close</option>
        <option value="WIP">WIP</option>
      </select>
    </div>

    <!-- Action Buttons -->
    <div style="display: flex; align-items: flex-start; margin-top: 25px; gap: 10px;">
      <button class="btn view-btn" (click)="RegionalDateFilter()">View</button>
      <button class="btn view-btn" (click)="ClearDateFilter()">Clear</button>
      <img src="../../../../assets/exportexcel.png" class="exportToExcel" (click)="exportRegionalTableToExcel()"
        ngbTooltip="Export to Excel">
    </div>

  </div>

  <div class="col-md-6" style="max-width: 100%;width: 90%; overflow-x: auto; margin-bottom: 60px; ">
    <div class="table-responsive" style="border: 1px solid #808080;">
      <table class="table  table-hover table-striped" style="width: 100%; table-layout: 100%;">
        <thead>
          <tr>
            <th style="position: sticky; left:0px; top:-1px; z-index: 4;">Sr<br>no</th>
            <th style="position: sticky; left: 32px; top: -1px;  z-index: 4;" container="body">Part Number</th>
            <th>Part Name</th>
            <th>MMID</th>
            <th>Program Name</th>
            <th>CAT4</th>
            <th>Supplier Mfg Location</th>
            <th>Annual<br>Volume <span class="my-icon" (click)="RegionalSortBy('AnnualVolume',$event)"><i
                  class="bi bi-sort-up"></i></span></th>
            <th>Supplier quoted/<br>Invoice Price <span class="my-icon" (click)="RegionalSortBy('TotalCost',$event)"><i
                  class="bi bi-sort-up"></i></span></th>
            <th>Supplier Name</th>
            <th>Best<br>Region</th>
            <th>Quoted Cost From<br>Best Region</th>
            <th>Region<br>Arbitrage (USD) <span class="my-icon" (click)="RegionalSortBy('RegionalArbitrage',$event)"><i
                  class="bi bi-sort-up"></i></span> </th>
            <th>Region Relation</th>
            <th>Project Status</th>
            <th>Debrief Date</th>
            <th>Comments</th>
            <th>User Activity</th>
            <th style="position: sticky; right: 0px; z-index: 3;" container="body">Action</th>
          </tr>
        </thead>
        <tbody>

          <tr
            *ngFor="let Region of Regional | search: textsearch:filterMetadata  | paginate: { itemsPerPage: 25, currentPage: page };  let i=index">
            <td style="position: sticky; left: 0px; ">{{ (page - 1) * pageSize + i + 1 }}</td>
            <td style="position: sticky; left: 32px;">
              <span ngbTooltip="{{Region.PartNumber}}"> {{Region.PartNumber.length > 10 ? Region.PartNumber.slice(0, 10)
                + '...' : Region.PartNumber}} </span>
            </td>
            <td>{{Region.PartName}}</td>
            <td> <a (click)="navigateToDetails(Region.CSHeaderID)" class="text-underlinecolour">{{Region.MMID}} </a>
            </td>
            <td>{{Region.ProgramName}}</td>
            <td>{{Region.CAT4}}</td>
            <td>{{Region.MainRegion}}</td>
            <td>{{Region.AnnualVolume | number:'1.0-0'}}</td>
            <td>$ {{Region.TotalCost}}</td>
            <td>{{Region.Supplier}}</td>
            <td>{{Region.BestRegion}}</td>
            <td>$ {{Region.BestRegionCost | number:'1.2-2'}}</td>
            <td>$ {{Region.RegionalArbitrage | number:'1.2-2'}}</td>
            <td>{{Region.RegionRelation}}</td>
            <td>
              <select [(ngModel)]="Region.ProjectStatus" class="form-select" [disabled]="editingIndexRegional !== i"
                style="width: 100%; height: 25px; font-size: 9px; font-weight: bold;">
                <option value="Open" selected>Open</option>
                <option value="WIP">WIP</option>
                <option value="Close">Close</option>
                <option value="Reject">Reject</option>
              </select>
            </td>
            <td>{{Region.DebriefDate}}</td>

            <td>
              <span (click)=" editingIndexRegional === i && openregioncomment(Region.Comments, i)"
                ngbTooltip="Region.Comments" [style.pointer-events]="editingIndexRegional !== i ? 'none' : 'auto'"
                style="cursor: pointer; color: #ef7659;">
                {{ Region.Comments && Region.Comments.length > 12? (Region.Comments | slice:0:12) + '...':
                Region.Comments || 'Add Comment' }}
              </span>
            </td>
            <td style="text-align: center;">
              <i class="bi bi-cloud-upload-fill"
                (click)="editingIndexRegional !== i && RegionUploadTCO(Region.Regional_ArtibageID)"
                style="color: #185ca4; font-size: 17px; cursor: pointer;" ngbTooltip="Upload Document"></i>
              <i class="bi bi-download"
                (click)="downloadArbitrageZip(Region.Regional_ArtibageID,Region.PartNumber,'regional')"
                style="color: #2fa365; font-size: 17px; cursor: pointer; margin-left: 10px;"
                ngbTooltip="Download Document"></i>
              <i class="bi bi-box-arrow-in-up-right" (click)="RouteToTco(Region.MMID,Region.RequestHeaderId)"
                style="color: #f0ad4e; font-size: 17px; cursor: pointer; margin-left: 10px;"
                ngbTooltip="Go to TCO Upload"></i>
            </td>
            <td style="position: sticky; right: 0px; text-align: center;">
              <ng-container *ngIf="editingIndexRegional === i; else editIcon">
                <i class="bi bi-check-circle-fill" (click)="SaveRegionChanges(Region)"
                  style="color: #2fa365;  font-size: 17px ; cursor: pointer;" ngbTooltip="Save"></i>
                <i class="bi bi-x-circle-fill" (click)="cancelEditingRegional()"
                  style="color: #da291c; font-size: 17px; cursor: pointer; margin-left: 10px;" ngbTooltip="Cancel"></i>
              </ng-container>
              <ng-template #editIcon>
                <i class="bi bi-pencil-fill" style="color: #da291c; font-size:larger; cursor: pointer; "
                  (click)="RegionaleditRow(i)" ngbTooltip="Edit" placement="top"></i>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': showregioncomment}" style="display: block;"
        *ngIf="showregioncomment">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Edit Comment</h5>
              <label class="close modal-close-icn" (click)="closeregioncomment()">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#000" class="bi bi-x"
                  viewBox="0 0 16 16">
                  <path
                    d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                </svg>
              </label>
            </div>
            <div class="modal-body">
              <textarea [(ngModel)]="selectedComment" rows="4" style="width: 100%;"></textarea>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-sm btn-secondary" (click)="saveRegionalComment()">Save</button>
              <button type="button" class="btn btn-sm  btn-default default-btn_popup"
                (click)="closeregioncomment()">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': ShowRegionalUpload}" style="display: block;"
        *ngIf="ShowRegionalUpload">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Upload Documents</h5>
              <label class="close modal-close-icn" (click)="closeRegionalupload()">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#000" class="bi bi-x"
                  viewBox="0 0 16 16">
                  <path
                    d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                </svg>
              </label>
            </div>
            <div class="modal-body">
              <div class="input-group custom-file-button" *ngIf="showFileUpload"
                style="margin-top: 10px; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto; display: flex; gap: 10px; align-items: center;">
                <label for="fileInput" class="input-group-text" style="flex-shrink: 0;">Select File</label>
                <input type="file" class="form-control" style="flex: 1;" (change)="RegionalFileSelection($event)"
                  multiple />
                <button type="button" class="btn btn-sm default-btn"
                  (click)="handleUpload('regional',selectedRegional_ArtibageID)"> Upload </button>
              </div>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-sm  btn-default default-btn_popup"
                (click)="closeRegionalupload()">Close</button>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="d-flex justify-content-between p-2 pagination">

      <ngb-pagination [collectionSize]="filterMetadata.count" [(page)]="page" [pageSize]="pageSize" [rotate]="true"
        [boundaryLinks]="true" [maxSize]="5" size="sm">
        <ng-template ngbPaginationPrevious>Prev</ng-template>
        <ng-template ngbPaginationNext>Next</ng-template>
      </ngb-pagination>
      <br>
    </div>
  </div>
</div>

<!------------------------------------------------end of Regional Arbitrage --------------------------->


<!------------------------------------------------start of mfg process Arbitrage --------------------------->

<div *ngIf="showmgfprocess" class="container-fluid"
  style="margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center;">
  <div class="row" style="width: 100%; display: flex; justify-content: center">
    <header style="text-align: center;font-size: 24px;">
      Region vs Cost per Kg Difference($)
    </header>
    <div class="graph">
      <div class="chart-box">
        <canvasjs-chart class="Mfgcanvas-chart" [options]="MfgchartOptions"
          id="chartOptionsId"></canvasjs-chart>
      </div>
    </div>

    <div class="filterlabel" style="display: flex; flex-wrap: wrap; gap: 15px;">

      <!-- Select Range -->
      <div style="display: flex; flex-direction: column;">
        <label for="date-range">Select:</label>
        <select id="date-range" [(ngModel)]="selectedRangeMfg" (change)="onDateRangeChangeMfg()" class="custom-input"
          style="padding: 5px">
          <option value="">Select Range</option>
          <option value="3">Last 3 Months</option>
          <option value="6">Last 6 Months</option>
          <option value="12">Last 1 Year</option>
          <option value="24">Last 2 Year</option>
          <option value="ALL">Select All</option>
          <option value="CUSTOM">Custom</option>
        </select>
      </div>

      <!-- From Date -->
      <div style="display: flex; flex-direction: column;">
        <label for="from-date">From Date:</label>
        <input type="date" id="from-date" [(ngModel)]="fromDateMfg" [disabled]="selectedRangeMfg !== 'CUSTOM'"
          [attr.min]="minDateMfg" [attr.max]="maxDateMfg" class="custom-input" style="padding: 5px" />
      </div>

      <!-- To Date -->
      <div style="display: flex; flex-direction: column;">
        <label for="to-date">To Date:</label>
        <input type="date" id="to-date" [(ngModel)]="toDateMfg" [disabled]="selectedRangeMfg !== 'CUSTOM'"
          [attr.min]="minDateMfg" [attr.max]="maxDateMfg" class="custom-input" style="padding: 5px" />
      </div>

      <!-- Status Filter -->
      <div style="display: flex; flex-direction: column;">
        <label for="status-filter">Status:</label>
        <select id="status-filter" [(ngModel)]="selectedStatus_mfg" class="custom-input" style="padding: 5px;">
          <option value="">All</option>
          <option value="Open">Open</option>
          <option value="Close">Close</option>
          <option value="WIP">WIP</option>
        </select>
      </div>

      <!-- Action Buttons -->
      <div style="display: flex; align-items: flex-start; gap: 10px; margin-top: 25px;">
        <button class="btn view-btn" (click)="onViewClickMfg()">View</button>
        <button class="btn view-btn" (click)="ClearAllMfg()">Clear</button>
        <img src="../../../../assets/exportexcel.png" class="exportToExcel" (click)="exportMfgTableToExcel()"
          ngbTooltip="Export to Excel">
      </div>

    </div>

    <div class="col-md-6" style="max-width: 90%; width: 100%; overflow-x: auto; margin-bottom: 60px">
      <div class="table-responsive" style="border: 1px solid #808080">
        <table class="table table-bordered table-hover table-striped" style="width: 100%; table-layout: 100%">
          <thead>
            <tr>
              <th style="position: sticky; left:0px; top:-1px; z-index: 4;">Sr<br />no</th>
              <th style="position: sticky; left: 32px; top: -1px;  z-index: 4;">Part Number1</th>
              <th>Part Number2</th>
              <th>Part Name</th>
              <th>MMID</th>
              <th>Program Name</th>
              <th>CAT4</th>
              <th>Supplier Mfg Location(Part1)</th>
              <th>Supplier Mfg Location(Part2)</th>
              <th>Process1 Tooling Cost</th>
              <th>Process2 Tooling Cost</th>
              <th>Process1 Invoice Cost</th>
              <th>Process2 Invoice Cost</th>

              <th>Process1 Annual Volume</th>
              <th>Process2 Annual Volume</th>
              <!-- <th>Supplier Quoted/Invoice<br />Price (USD) 
                 <i (click)="MfgSortBy('TargetQuote')" class="my-icon bi bi-sort-up"></i>
                </th> -->


              <th>Debrief Date</th>
              <th>Process1 Quote/Should Cost <span class="my-icon" (click)="MfgSortBy('Col2_First',$event)"><i
                    class="bi bi-sort-up"></i></span> </th>
              <th>Process1 Name</th>
              <th>Process2 Quote/Should Cost <span class="my-icon" (click)="MfgSortBy('Col2_Second',$event)"><i
                    class="bi bi-sort-up"></i></span></th>
              <th>Process2 Name</th>
              <th>Should Cost Variation in the Process <span class="my-icon"
                  (click)="MfgSortBy('Col2_First-Col2_Second',$event)"><i class="bi bi-sort-up"></i></span> </th>
              <th>Invoice Cost Variation</th>
              <th>High Level Process </th>

              <th>Weight(Part1)</th>
              <th>Weight(Part2)</th>
              <th>Cost Per Kg(Part1)</th>
              <th>Cost Per Kg(Part2)</th>
              <th>Cost Per Kg <br> Difference </th>
              <th>User<br />Activity</th>

              <th>Comments</th>
              <th>Submitted By</th>
              <th>Project Status</th>
              <th style="position: sticky; right: 0px; z-index: 4">Action</th>

            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let data of mgfprocess | search: textsearch:filterMetadata  | paginate: { itemsPerPage: 25, currentPage: page }; let i = index">

              <td style="position: sticky; left:0px;">{{ (page - 1) * pageSize + i + 1 }}</td>
              <!-- <td style="position: sticky; left: 31px;">{{ data.PartNumber }}</td> -->
              <td style="position: sticky; left: 32px;">
                <span ngbTooltip="{{data.PartNumber}}"> {{data.PartNumber.length > 10 ? data.PartNumber.slice(0, 10) +
                  '...' : data.PartNumber}} </span>
              </td>
              <td>{{data.Part2}}</td>
              <td>{{ data.PartName }}</td>
              <td> <a (click)="navigateToDetails(data.CSHeaderID)" class="text-underlinecolour">{{ data.UniqueId }} </a>
              </td>
              <td>{{ data.ProgramName }}</td>
              <td>{{data.CAT4}}</td>
              <td>{{ data.MfgRegion }}</td>
              <td>{{ data.Part2_region }}</td>
              <td>{{ data.Process1_ToolingCost ? ('$' + roundToTwoDecimalPlaces(data.Process1_ToolingCost)) : '' }}</td>
              <td>{{ data.Process2_ToolingCost ? ('$' + roundToTwoDecimalPlaces(data.Process2_ToolingCost)) : '' }}</td>
              <td>{{ data.Process1_InvoiceCost ? ('$' + roundToTwoDecimalPlaces(data.Process1_InvoiceCost)) : '' }}</td>
              <td>{{ data.Process2_InvoiceCost ? ('$' + roundToTwoDecimalPlaces(data.Process2_InvoiceCost)) : '' }}</td>

              <td>{{ data.Process1_AnnualVolume ? ('$' + roundToTwoDecimalPlaces(data.Process1_AnnualVolume)) : '' }}
              </td>
              <td>{{ data.Process2_AnnualVolume ? ('$' + roundToTwoDecimalPlaces(data.Process2_AnnualVolume)) : '' }}
              </td>

              <td>{{ data.DebriefDate?.split('T')[0] }}</td>

              <td>{{ data.Col2_First ? ('$' + data.Col2_First.toFixed(2)) : '' }}</td>
              <td>{{ data.HighLevelProcess_First }}</td>
              <td>{{ data.Col2_Second ? ('$' + data.Col2_Second.toFixed(2)) : '' }}</td>
              <td>{{ data.HighLevelProcess_Second }}</td>
              <td>{{ (data.Col2_First && data.Col2_Second) ? ('$' + getAbsoluteDifferenceMfg(data.Col2_First,
                data.Col2_Second).toFixed(2)) : '' }}</td>

              <td>{{ getInvoiceCostVariation(data) }}</td>
              <td>{{ data.ProcessFlow }}</td>
              <td>{{data.Part1_weight}}</td>
              <td>{{data.Part2_weight}}</td>
              <td>{{data.FromCostPerKg}}</td>
              <td>{{data.ToCostPerKg}}</td>
              <td>{{data.CostPerKgDifference}}</td>
              <td style="text-align: center">
                <i class="bi bi-cloud-upload-fill" (click)="openUploadPopupMfg(data.Mfg_ArtibageID)"
                  style="color: #185ca4; font-size: 17px; cursor: pointer" ngbTooltip="Upload Document">
                </i>
                <i class="bi bi-download" (click)="downloadArbitrageZip(data.Mfg_ArtibageID,data.PartNumber,'mfg')"
                  style="color: #2fa365;font-size: 17px;cursor: pointer;margin-left: 10px;"
                  ngbTooltip="Download Document"></i>
              </td>


              <td>
                <span (click)="openCommentsPopupMfg(data.Comments, i)" style="cursor: pointer; color: #ef7659">
                  {{ data.Comments && data.Comments.length > 12 ? (data.Comments | slice : 0 : 12) + "..." :
                  data.Comments || "Add Comment"}}
                </span>
              </td>

              <td>{{ data.ModifiedBy }}</td>
              <td>
                <select [(ngModel)]="data.ProjectStatus" [disabled]="editingIndexMfg !== i" class="form-select"
                  style=" width: 100%; height: 25px; font-size: 9px; font-weight: bold;">
                  <option class="ttt" value="Open" selected>Open</option>
                  <option value="WIP">WIP</option>
                  <option value="Close">Close</option>
                  <option value="Reject">Reject</option>
                </select>
              </td>
              <td style="position: sticky; right: 0px; text-align: center">
                <ng-container *ngIf="editingIndexMfg === i; else editIcon">
                  <i class="bi bi-check-circle-fill" (click)="saveChangesMfg(data)"
                    style="color: #2fa365; font-size: 17px; cursor: pointer" ngbTooltip="Save"></i>
                  <i class="bi bi-x-circle-fill" (click)="cancelEditingMfg()"
                    style=" color: #da291c;font-size: 17px;cursor: pointer;margin-left: 10px; " title="Cancel"></i>
                </ng-container>
                <ng-template #editIcon>
                  <i class="bi bi-pencil-fill" style="color: #da291c; font-size: larger; cursor: pointer"
                    (click)="editRowMfg(i)" ngbTooltip="Edit"></i>
                </ng-template>
              </td>
              <!-- <td >{{ data.DebriefDate }}</td> -->

            </tr>
          </tbody>
        </table>

        <div class="modal" tabindex="-1" role="dialog" [ngClass]="{ show: showModalMfg }" style="display: block"
          *ngIf="showModalMfg">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Edit Comment</h5>
                <label class="close modal-close-icn" (click)="closeCommentsPopupMfg()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#000" class="bi bi-x"
                    viewBox="0 0 16 16">
                    <path
                      d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                  </svg>
                </label>
              </div>
              <div class="modal-body">
                <textarea [(ngModel)]="selectedCommentMfg" rows="4" style="width: 100%"></textarea>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-secondary" (click)="saveCommentMfg()"> Save </button>
                <button type="button" class="btn btn-sm btn-default default-btn_popup"
                  (click)="closeCommentsPopupMfg()"> Close</button>
              </div>
            </div>
          </div>
        </div>

        <div class="modal" tabindex="-1" role="dialog" [ngClass]="{ show: showTcoUploadModalMfg }"
          style="display: block" *ngIf="showTcoUploadModalMfg">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Upload Documents</h5>
                <label class="close modal-close-icn" (click)="closeUploadPopupMfg()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#000" class="bi bi-x"
                    viewBox="0 0 16 16">
                    <path
                      d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                  </svg>
                </label>
              </div>
              <div class="modal-body">
                <div class="input-group custom-file-button" *ngIf="showFileUploadMfg"
                  style="margin-top: 10px; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto; display: flex; gap: 10px; align-items: center;">
                  <label for="fileInput" class="input-group-text" style="flex-shrink: 0;">Select File</label>
                  <input type="file" class="form-control" style="flex: 1;" (change)="handleFileSelectionMfg($event)"
                    multiple />
                  <button type="button" class="btn btn-sm default-btn" (click)="handleUpload('mfg',selectedMfgId)">
                    Upload </button>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-sm  btn-default default-btn_popup" data-bs-dismis="modal"
                  (click)="closeUploadPopupMfg()">Close</button>
                <!-- <button type="button" class="btn btn-sm  btn-default default-btn_popup">Save</button> -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-between p-2 pagination">

        <ngb-pagination [collectionSize]="filterMetadata.count" [(page)]="page" [pageSize]="pageSize" [rotate]="true"
          [boundaryLinks]="true" [maxSize]="5" size="sm">
          <ng-template ngbPaginationPrevious>Prev</ng-template>
          <ng-template ngbPaginationNext>Next</ng-template>
        </ngb-pagination>
        <br>
      </div>
    </div>

    <div class="col-md-6" style="max-width: 90%; width: 100%; overflow-x: auto; margin-bottom: 60px">
      <div class="table-responsive" style="border: 1px solid #808080">
        <table class="table table-bordered table-hover table-striped" style="width: 100%; table-layout: 100%">
          <thead>
            <tr>
              <th style="position: sticky; left:0px; top:-1px; z-index: 4;">Sr<br />no</th>
              <th style="position: sticky; left: 32px; top: -1px; z-index: 4;">Part Number</th>
              <th>Part Name</th>
              <th>MMID</th>
              <th>Program Name</th>
              <th>Supp Mfg <br>Location</th>
              <th>Debrief Date</th>
              <th>High Level Process</th>
              <th>Should Cost</th>
              <th>Finish Weight (kg)</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of mgfprocessComparison 
                        | paginate: { itemsPerPage: pageSizeComparison, currentPage: pageComparison }; 
                        let i = index">
              <td style="position: sticky; left:0px;">
                {{ (pageComparison - 1) * pageSizeComparison + i + 1 }}
              </td>
              <td style="position: sticky; left: 32px;">
                <span ngbTooltip="{{data.PartNumber}}">
                  {{ data.PartNumber.length > 10 ? data.PartNumber.slice(0, 10) + '...' : data.PartNumber }}
                </span>
              </td>
              <td>{{ data.PartName }}</td>
              <td class="align-center"> <a (click)="navigateToDetails(data.CSHeaderID)"
                  class="text-underlinecolour">{{data.MMID}} </a> </td>
              <td>{{ data.ProgramName }}</td>
              <td>{{ data.MfgRegion }}</td>
              <td>{{ data.DebriefDate}}</td>
              <td>{{ data.HighLevelProcess }}</td>
              <td>$ {{ data.ShouldCost | number:'1.2-2' }}</td>
              <td>{{ data.FinishWeight }}</td>
            </tr>
          </tbody>
        </table>
      </div>


      <div class="d-flex justify-content-between p-2 pagination">
        <ngb-pagination [collectionSize]="mgfprocessComparison.length" [(page)]="pageComparison"
          [pageSize]="pageSizeComparison" [rotate]="true" [boundaryLinks]="true" [maxSize]="5" size="sm">
          <ng-template ngbPaginationPrevious>Prev</ng-template>
          <ng-template ngbPaginationNext>Next</ng-template>
        </ngb-pagination>
      </div>
    </div>

  </div>
</div>

<!------------------------------------------------end of mfg process Arbitrage --------------------------->


<!------------------------------------------------start of design Arbitrage --------------------------->

<div *ngIf="showdesign" class="container-fluid"
  style="margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center;">

  <div class="row" style="width: 100%; display: flex; justify-content: center; ">
    <div class="graph">
      <div class="chart-box">
        <canvasjs-chart class="canvas-chart" [options]="Designchartoptions"
          [styles]="{ width: '100%', height: '400px', display: 'block' }" id="designChartContainer">
        </canvasjs-chart>
      </div>
    </div>

    <div class="col-md-6" style="max-width: 100%; width: 90%; margin-bottom: 20px">
      <fieldset class="border rounded-3 p-3">
        <legend class="w-auto labelDetailsheader" style="margin-top:0px;">Rules Details</legend>
          <div>
            <table style="width: 100%;">
              <tr *ngFor="let rule of attributeRules">
                <td colspan="4">
                  <div style="margin-top: 10px;"> 
                  <!-- Fixed Rule Parameters in 3-column layout -->
                  <table style="width: 100%;" class="fixed-table">
                    <tr>
                      <td style="width: 15%;"><label class="default-lbl">Part Name :</label></td>
                      <td style="width: 18%;"><label class="default-lblvalue">{{ChekNull(rule.PartName)}}</label></td>
                      <td style="width: 15%;"><label class="default-lbl">Length Rule :</label></td>
                      <td style="width: 18%;"><label class="default-lblvalue">{{ChekNull(rule.LengthRule)}}</label></td>
                      <td style="width: 15%;"><label class="default-lbl">Width Rule :</label></td>
                      <td style="width: 18%;"><label class="default-lblvalue">{{ChekNull(rule.WidthRule)}}</label></td>
                    </tr>
                    <tr>
                      <td><label class="default-lbl">Height Rule :</label></td>
                      <td><label class="default-lblvalue">{{ChekNull(rule.HeightRule)}}</label></td>
                      <td><label class="default-lbl">Weight Rule :</label></td>
                      <td><label class="default-lblvalue">{{ChekNull(rule.WeightRule)}}</label></td>
                      <td><label class="default-lbl">Material Grade Rule :</label></td>
                      <td><label class="default-lblvalue">{{ChekNull(rule.MaterialTypeGradeRule)}}</label></td>
                    </tr>
                    <tr>
                      <td><label class="default-lbl">Region Rule :</label></td>
                      <td><label class="default-lblvalue">{{ChekNull(rule.RegionRule)}}</label></td>
                      <td><label class="default-lbl">Debrief Date Rule :</label></td>
                      <td><label class="default-lblvalue">{{ChekNull(rule.DebriefDateRule)}}</label></td>
                      <td><label class="default-lbl">Type Code :</label></td>
                      <td><label class="default-lblvalue">{{ChekNull(rule.TypeCode)}}</label></td>
                    </tr>
                  </table>
                  </div>
            
                  <!-- Dynamic Parameters Table -->
                  <label class="labelDetails" style="margin-top: 10px; margin-bottom: 3px;">Parameters Details</label>
                  <table style="width: 100%; margin-top: 10px;" class="dynamic-table">
                    <thead>
                      <tr>
                        <th *ngFor="let header of rule.paramHeaders1">{{ header }}</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td *ngFor="let header of rule.paramHeaders1">
                          {{ SafeValue(rule.paramMap[header]) }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </td>
              </tr>
            </table>            
           
          </div>

          <div class="row mt-3">
            <div class="col-md-12">
              <label class="labelDetails" style="font-size: 12px;">Legend:</label>
              <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; font-size: 12px;">
                <div style="display: flex; align-items: center;">
                  <img src="assets/dashboard_icon.png" alt="R20 Icon" style="width: 12px; height: 12px; margin-right: 6px;" />
                  <span>R20: Parameter should be within ¬±20%</span>
                </div>
      
                <div style="display: flex; align-items: center;">
                  <img src="assets/dashboard_icon.png" alt="R10 Icon" style="width: 12px; height: 12px; margin-right: 6px;" />
                  <span>R10: Parameter should be within ¬±10%</span>
                </div>
      
                <div style="display: flex; align-items: center;">
                  <img src="assets/dashboard_icon.png" alt="Optional Icon" style="width: 12px; height: 12px; margin-right: 6px;" />
                  <span>O: Optional</span>
                </div>
      
                <div style="display: flex; align-items: center;">
                  <img src="assets/dashboard_icon.png" alt="Exact Icon" style="width: 12px; height: 12px; margin-right: 6px;" />
                  <span>E: Exact value only</span>
                </div>
              </div>
            </div>
          </div>
      </fieldset>
    </div>
    <!-- <div class="filterlabel" style="display: flex; flex-wrap: wrap; gap: 15px;"> -->
      <!-- Action Buttons -->
      
    <!-- </div> -->

    <div class="col-md-6" style="max-width: 100%; width: 90%; margin-bottom: 10px;">
      <!-- Export Icon Positioned Top-Right of Table -->
      <div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px; margin-bottom: 5px;">
        <img src="../../../../assets/exportexcel.png" class="exportToExcel" (click)="  exportDesignTableToExcel()"
             ngbTooltip="Export to Excel">
      </div>
      </div>

    <div class="col-md-6" style="max-width: 100%;width: 90%; overflow-x: auto;margin-bottom: 60px;  ">
      <div class="table-responsive" style="border: 1px solid #808080;">
        <table class="table table-bordered table-hover table-striped"
          style="width: 100%; table-layout: auto; font-size: 7px;">
          <thead>
            <tr>
              <!-- Static Headers -->
              <th>Sr<br>no</th>
              <th>Part Name</th>
              <th>Part Number</th>
              <!-- <th>Part Number2</th> -->
              <th>Should Cost</th>
              <!-- <th>Should Cost(Part2)</th> -->
              <!-- <th>Should Cost Diff</th> -->

              <th>Cost Per Kg</th>
              <!-- <th>Cost PerKg(Part2)</th> -->
              <!-- <th>Cost PerKg Diff</th> -->
              <th>Weight</th>
              <!-- <th>Weight(Part2)</th> -->
              <th>Platform</th>
              <th>Type Code</th>
              <th>Length</th>
              <th>Width</th>
              <th>Height</th>
              <th>Cluster ID</th>
              <th>Engine <br>Displacement</th>
              <th>Program Name</th>
              <th>Supp Mfg <br>Location</th>
              <th>Debrief Date</th>
              <ng-container *ngFor="let header of parameterHeaders">
                <th>{{ header || '-' }}</th>
              </ng-container>
              <!-- <th>Design Remarks</th> -->

            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let data of design; let i = index">
              <!-- Static Data -->
              <td>{{ i + 1 }}</td>
              <td>{{ data.PartName }}</td>
              <td>{{ data.PartNumber }}</td>
              <!-- <td>{{ data.ToPart }}</td> -->
              <td>${{ data.ArbitrageValue.toFixed(2) }}</td>
              <!-- <td>${{ data.ToCost.toFixed(2) }}</td> -->
              <!-- <td>${{ data.ArbitrageValue.toFixed(2) }}</td> -->

              <td>${{ data.FromCostPerKg.toFixed(2) }}</td>
              <!-- <td>${{ data.ToCostPerKg.toFixed(2) }}</td> -->
              <!-- <td>${{ data.CostPerKgDifference.toFixed(2) }}</td> -->
              <td>{{ data.FromPartWeight }}</td>
              <!-- <td>{{ data.ToPartWeight }}</td> -->
              <td>{{ data.Plat_form}}</td>
              <td>{{ data.Type_Code }}</td>
              <td>{{ data.Length }}</td>
              <td>{{ data.Width }}</td>
              <td>{{ data.Height }}</td>
              <td>{{ data.ClusterId }}</td>
              <td>{{ data.EngineDisplacement }}</td>
              <td>{{ data.ProgramName }}</td>
              <td>{{ data.MfgRegion }}</td>
              <td>{{ data.DebriefDate }}</td>
              <ng-container *ngFor="let header of parameterHeaders">
                <td>
                  <div style="text-align: center;">
                    <div>{{ data.paramMap[header] || '-' }}</div>
                  </div>
                </td>
              </ng-container>
              <!-- <td>{{ data.DesignRemarks }}</td> -->
            </tr>
          </tbody>
        </table>

      </div>
    </div>
  </div>
  <!-- </div> -->
</div>
<!-- Warning Popup -->

<div class="warning-popup_design" *ngIf="showDesignWarning">
  <div class="popup-content_design">
    <!-- <h3>‚ö† Warning</h3> -->
    <h3 class="warning-title_design">
      <span class="icon_design">
        <!-- SVG icon -->
        <svg fill="#fb0e0e" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
          <path d="M23,23H1c-0.4,0-0.7-0.2-0.9-0.5c-0.2-0.3-0.2-0.7,0-1l11-20c0.4-0.6,1.4-0.6,1.8,0l11,20c0.2,0.3,0.2,0.7,0,1 
      C23.7,22.8,23.4,23,23,23z M2.7,21h18.6L12,4.1L2.7,21z" />
          <path d="M12,16c-0.6,0-1-0.4-1-1v-5c0-0.6,0.4-1,1-1s1,0.4,1,1v5C13,15.6,12.6,16,12,16z" />
          <circle cx="12" cy="18" r="1" />
        </svg>
      </span>
      Warning
    </h3>

    <p class="warning-msg">Please select only one category at a time for Design view.</p>
    <div class="popup-actions_design">
      <!-- <button class="cancel-btn_design" (click)="closeDesignWarning()">Cancel</button> -->
      <button class="proceed-btn_design" (click)="backToCat3()">Proceed</button>

    </div>
  </div>
</div>






<!------------------------------------------------end of design Arbitrage --------------------------->